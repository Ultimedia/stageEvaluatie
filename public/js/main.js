!function(a,b){b["true"]=a;var c={views:{},models:{},routers:{},collections:{},settings:{},utils:{},templates:{}};c.settings.apiPath="/api",c.settings.defaultLanguage="/nl",$(document).on("ready",function(){c.utils.templates.load(["AppView","LoginView","RegisterView","HomeView","EvaluateView","ScorePanelView","InternListView","QuestionListView","NotFoundView"],function(){c.settings=new Settings;var a=new c.views.AppView;$("body").prepend(a.render().$el),Backbone.history.start()})}),Answer=Backbone.Model.extend({defaults:{evaluation_id:"",question_id:"",question_rating_id:"",remarks:""},url:c.settings.apiPath+"/answer",initialize:function(){}}),Company=Backbone.Model.extend({url:c.settings.apiPath+"/companies",defaults:{company_email:void 0,company_contact:void 0,company_name:void 0,company_id:0},initialize:function(){}}),Evaluation=Backbone.Model.extend({url:c.settings.apiPath+"/evaluation",defaults:{company_id:"",internship_id:"",evaluate_term:"",final_score:"",update_score:!1},initialize:function(){}}),Internship=Backbone.Model.extend({defaults:{internship_id:void 0,international:void 0,student:void 0,email:void 0,organisation:void 0,mentor:void 0,location:void 0,discipline:void 0,coach:void 0,evaluations:[]},initialize:function(a,b){this.id=b.id},url:function(){return c.settings.apiPath+"/internshipd/"+this.attributes.internship_id}}),Question=Backbone.Model.extend({defaults:{question_id:void 0,question_description_nl:void 0,question_description_en:void 0,evaluation_id:void 0,question_rating_id:void 0,remarks:void 0},initialize:function(){}}),Score=Backbone.Model.extend({defaults:{question_rating_id:void 0,question_rating_rating_nl:void 0,question_rating_rating_en:void 0,question_ratings_context_nl:void 0,question_ratings_context_en:void 0,question_rating_points:void 0},initialize:function(){}}),Settings=Backbone.Model.extend({defaults:{loggedIn:!1,language:"nl",copy:{nl:{general:{title:"DEVINE STAGE EVALUATIE"},home:{companyBtn:"STAGEBEDRIJF OF ORGANISATIE"},registration:{registerTitle:"Registratie",registerBtn:"REGISTREER",nameField:"NAAM",emailField:"EMAIL",companyField:"BEDRIJF",verifyCode:"VERIFICATIE CODE",registerError:"De verificatie code is niet correct!"},login:{loginBtn:"LOGIN",emailField:"EMAIL",passwordField:"PASWOORD",loginError:"Je paswoord is niet correct of je hebt geen toegang tot het stageplatform."},internships:{studentLabel:"Student",organisationLabel:"Organisatie",mentorLabel:"Begeleider",interimLabel:"Tussentijdse evaluatie",finalLabel:"Eindevaluatie",evaluateBtn:"Vul aan..."},evaluation:{questionLabel:"Vraag",ratingLabel:"Beoordeling",scoreLabel:"Punt",remarkLabel:"Opmerking",selectionLabel:"Maak een keuze",requiredField:"Dit veld moet worden ingevuld",finalScoreLabel:"Eindscore",interimLabel:"Tussentijdse evaluatie",finalLabel:"Eindevaluatie",saveLabel:"Bewaar",exportLabel:"Download PDF"},error:{notFound:"<b>404:</b> Deze pagina werd niet gevonden"}},en:{general:{title:"DEVINE INTERNSHIP EVALUATION"},home:{companyBtn:"COMPANY OR ORGANISATION"},registration:{registerTitle:"Registration",registerBtn:"REGISTER",nameField:"NAME",emailField:"EMAIL",companyField:"COMPANY",verifyCode:"VERIFICATION CODE",registerError:"The verification code is incorrect!"},login:{loginBtn:"LOGIN",emailField:"EMAIL",passwordField:"PASSWORD",loginError:"The password you have entered is not correct."},internships:{studentLabel:"Student",organisationLabel:"Organisation",mentorLabel:"Coach",interimLabel:"Interim evaluation",finalLabel:"Final evaluation",evaluateBtn:"Evaluate..."},evaluation:{questionLabel:"Question",ratingLabel:"Rating",scoreLabel:"Score",remarkLabel:"Remark",selectionLabel:"Select a score",requiredField:"This field is required",finalScoreLabel:"Final score",interimLabel:"Interim evaluation",finalLabel:"Final evaluation",saveLabel:"Save",exportLabel:"Download PDF"},error:{notFound:"<b>404:</b> The page could not be found"}}}},initialize:function(){this.bind("change:language",this.languageChangeHandler)},languageChangeHandler:function(){Backbone.trigger("languageChangeHandler")}}),User=Backbone.Model.extend({defaults:{email:"",password:""},url:c.settings.apiPath+"/login",initialize:function(){}}),CompanyCollection=Backbone.Collection.extend({model:Company,initialize:function(){}}),EvaluationCollection=Backbone.Collection.extend({model:Answer,initialize:function(a,b){this.id=b.id,this.term=b.term},url:function(){return"/api/answers/"+this.id}}),InternshipCollection=Backbone.Collection.extend({url:c.settings.apiPath+"/internships",model:Internship,initialize:function(){}}),QuestionsCollection=Backbone.Collection.extend({url:c.settings.apiPath+"/questions",model:Question,initialize:function(){}}),ScoresCollection=Backbone.Collection.extend({url:c.settings.apiPath+"/scores",model:Question,initialize:function(){}}),c.views.AppView=Backbone.View.extend({tagName:"div",id:"application",initialize:function(){_.bindAll(this),c.collections.questions=new QuestionsCollection,c.collections.questions.fetch(),c.collections.internsCollection=new InternshipCollection,c.collections.internsCollection.fetch(),c.collections.scores=new ScoresCollection,c.collections.scores.fetch(),Backbone.on("languageChangeHandler",this.changeLanguage)},events:{"click #languageSelection":"languageClickHandler","click #logo":"logoClickHandler"},logoClickHandler:function(){c.router.navigate("#evaluate",!0)},languageClickHandler:function(a){$(a.target).hasClass("selected")||($("#languageSelection li a").toggleClass("selected"),c.settings.set("language",$(a.target).attr("data-lang")))},render:function(){return this.$el.html(this.template({copy:c.settings.attributes.copy[c.settings.attributes.language].general})),c.router=new c.routers.AppRouter,this},changeLanguage:function(){}}),c.views.EvaluateView=Backbone.View.extend({initialize:function(){_.bindAll(this),c.collections.internsCollection=new InternshipCollection,c.collections.internsCollection.on("sync reset",this.render),c.collections.internsCollection.fetch(),Backbone.on("languageChangeHandler",this.render)},renderTableViews:function(a){var b=new c.views.InternListView({model:a});$("#internshipsTable tbody").append(b.render().$el)},render:function(){return this.$el.html(this.template({copy:c.settings.attributes.copy[c.settings.attributes.language].internships})),$("#internshipsTable tbody",this.$el).empty(),c.collections.internsCollection.each(function(a){this.renderTableViews(a)},this),this}}),c.views.HomeView=Backbone.View.extend({initialize:function(){_.bindAll(this),Backbone.on("languageChangeHandler",this.render)},render:function(){return this.$el.html(this.template({copy:c.settings.attributes.copy[c.settings.attributes.language].home})),this}}),c.views.InternListView=Backbone.View.extend({tagName:"tr",initialize:function(){_.bindAll(this),Backbone.on("languageChangeHandler",this.render)},events:{"click .evaluateList":"evaluateListHandler"},evaluateListHandler:function(a){var b=$(a.target).attr("data-id"),c=$(a.target).attr("data-target");window.location.hash="#rate/"+c+"/"+b},render:function(){this.$el.html(this.template({internship:this.model.toJSON(),copy:c.settings.attributes.copy[c.settings.attributes.language].internships}));var a=this.$el,b=this.model.get("evaluations");return b.length>0&&$(b).each(function(b,c){if(""!==c.final_score)switch(c.evaluate_term){case"interim":$(".interim-score ",a).empty().text(c.final_score);break;case"final":$(".final-score",a).empty().text(c.final_score)}}),this}}),c.views.LoginView=Backbone.View.extend({initialize:function(){_.bindAll(this),Backbone.on("languageChangeHandler",this.render)},render:function(){this.$el.html(this.template({copy:c.settings.attributes.copy[c.settings.attributes.language].login}));var a=this.$el;return $("#loginForm",this.$el).validate({submitHandler:function(){c.models.userModel=new User,c.models.userModel.set("password",$("#password",a).val()),c.models.userModel.set("email",$("#email",a).val()),c.models.userModel.save(null,{success:function(){$("#errorBox").addClass("hide"),c.settings.set("loggedIn",!0),c.router.navigate("evaluate",!0)},error:function(){$("#errorBox").removeClass("hide")}})}}),this}}),c.views.NotFoundView=Backbone.View.extend({initialize:function(){_.bindAll(this),Backbone.on("languageChangeHandler",this.render)},render:function(){return this.$el.html(this.template({copy:c.settings.attributes.copy[c.settings.attributes.language].error})),this}}),c.views.QuestionListView=Backbone.View.extend({tagName:"tr",className:"score",initialize:function(){_.bindAll(this)},events:{"change .score-option":"scoreOptionChangeHandler"},scoreOptionChangeHandler:function(a){var b=c.collections.scores.models[parseInt(a.currentTarget.selectedIndex)-1];$(".score-points",this.$el).text(b.get("question_rating_points"))},render:function(){return this.$el.html(this.template({question:this.model.toJSON(),scoreOptions:c.collections.scores.toJSON(),language:c.settings.attributes.language,copy:c.settings.attributes.copy[c.settings.attributes.language].evaluation})),this.model.attributes.question_rating_points&&$(".score-points",this.$el).text(this.model.attributes.question_rating_points),this}}),c.views.RegisterView=Backbone.View.extend({initialize:function(){_.bindAll(this),Backbone.on("languageChangeHandler",this.render)},render:function(){return this.$el.html(this.template({copy:c.settings.attributes.copy[c.settings.attributes.language].registration})),this.wireForm(),this},wireForm:function(){$("#registerForm",this.$el).validate({submitHandler:function(){var a=new Company;a.set("company_contact",$("#nameInput",this.$el).val()),a.set("company_email",$("#emailInput",this.$el).val()),a.set("company_name",$("#bedrijfInput",this.$el).val()),a.set("verify_code",$("#verifyCode",this.$el).val()),a.save(null,{success:function(){c.settings.set("loggedIn",!0),c.models.myCompanyModel=a,c.router.navigate("evaluate",!0),$("#errorBox").addClass("hide")},error:function(){$("#errorBox").removeClass("hide")}})}})}}),c.views.ScorePanelView=Backbone.View.extend({initialize:function(){_.bindAll(this),c.collections.questions=new QuestionsCollection,c.collections.questions.on("sync reset",this.render),c.collections.questions.fetch(),Backbone.on("languageChangeHandler",this.render)},pdfDownloadHandler:function(){alert("work in progress")},saveHandler:function(){$("#evaluateForm").submit()},events:{"change #totalScoreOptions":"totalScoreChangeHandler","click #pdfDownload":"pdfDownloadHandler","click #save":"saveHandler"},totalScoreChangeHandler:function(a){var b=c.collections.scores.models[parseInt(a.currentTarget.selectedIndex)-1],d=b.get("question_ratings_context_nl");"en"==c.settings.attributes.language&&(d=b.get("question_ratings_context_en")),$(".score-description",this.$el).text(d)},renderQuestionViews:function(a){var b=new c.views.QuestionListView({model:a,collection:this.collection});$("#evaluateTable tbody").append(b.render().$el)},render:function(){var a=(this.collection.term,null);if(c.models.selectedScoreModel=this.model,c.models.selectedScoreModel=c.collections.scores.where({question_rating_points:this.model.attributes.final_score})[0],c.models.selectedScoreModel&&(a=c.models.selectedScoreModel.attributes.question_rating_id),this.$el.html(this.template({scoreOptions:c.collections.scores.toJSON(),internship:c.models.selectedInternshipModel.toJSON(),term:this.collection.term,selectedScore:a,copy:c.settings.attributes.copy[c.settings.attributes.language].evaluation,language:c.settings.attributes.language})),c.models.selectedScoreModel){var b=c.models.selectedScoreModel.attributes.question_ratings_context_nl;"en"===c.settings.attributes.language&&(b=c.models.selectedScoreModel.attributes.question_ratings_context_en),$(".score-description",this.$el).text(b)}$("#evaluateTable tbody").empty(),c.collections.questions.each(function(a){this.renderQuestionViews(a)},this),this.wireForm();var d=this.renderQuestionViews,e=this.collection;return $.when(this.collection.fetch()).then(function(){e.models.length>0&&($("#evaluateTable tbody").empty(),e.each(function(a){d(a)},this))}),this},wireForm:function(){var a=parseInt(this.collection.id),b=(this.collection.term,this.model);$("#evaluateForm",this.$el).validate({submitHandler:function(){$(".score").each(function(b,c){var d=new Answer;d.set("evaluation_id",a),d.set("question_rating_id",parseInt($(".score-option",c)[0].selectedIndex)),d.set("question_id",$("td",c).first().attr("data-id")),d.set("remarks",$("textarea",c).val()),d.save()});var d=parseInt($("#totalScoreOptions")[0].selectedIndex-1),e=c.collections.scores.models[d].attributes.question_rating_points;b.set("update_score",!0),b.set("final_score",e),$.when(b.save()).then(function(){window.location="#evaluate"})}})}}),c.routers.AppRouter=Backbone.Router.extend({routes:{"":"home",login:"login",register:"register",evaluate:"evaluate","rate/interim/:id":"rateinterim","rate/final/:id":"ratefinal","*notFound":"notfound"},initialize:function(){this.routesHit=0,Backbone.history.on("route",function(){this.routesHit++},this)},home:function(){$("#container").empty().append((new c.views.HomeView).render().$el)},login:function(){$("#container").empty().append((new c.views.LoginView).render().$el)},register:function(){$("#container").empty().append((new c.views.RegisterView).render().$el)},evaluate:function(){c.settings.get("loggedIn")?$("#container").empty().append((new c.views.EvaluateView).render().$el):c.router.navigate("",!0)},rateinterim:function(a){this.rate(a,"interim")},ratefinal:function(a){this.rate(a,"final")},rate:function(a,b){c.settings.get("loggedIn")?$.when(c.collections.internsCollection.fetch()).then(function(){var d=c.collections.internsCollection.where({internship_id:a}),e=b;c.models.selectedInternshipModel=d[0],c.models.evaluationModel=new Evaluation,c.models.myCompanyModel&&c.models.evaluationModel.set("company_id",c.models.myCompanyModel.get("company_id")),c.models.evaluationModel.set("update_score",!1),c.models.evaluationModel.set("internship_id",a),c.models.evaluationModel.set("evaluate_term",e),c.models.evaluationModel.save(null,{success:function(a){c.collections.evaluationCollection=new EvaluationCollection([],{id:a.attributes.evaluation_id,term:e}),$("#container").empty().append(new c.views.ScorePanelView({collection:c.collections.evaluationCollection,model:c.models.evaluationModel}).render().$el)},error:function(){alert("error bij het ophalen van de data")}})}):c.router.navigate("",!0)},notfound:function(){$("#container").empty().append((new c.views.NotFoundView).render().$el)}}),c.utils.templates=function(){var a=function(a,b){var d=[];$.each(a,function(a,b){c.views[b]?d.push($.get("public/templates/"+b+".html",function(a){c.views[b].prototype.template=_.template(a)},"html")):alert(b+" not found")}),$.when.apply(null,d).done(b)};return{load:a}}()}({},function(){return this}());